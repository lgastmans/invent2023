<?require_once("../include/const.inc.php");require_once("../include/session.inc.php");require_once("../include/db.inc.php");require_once "../include/grid.inc.php";$int_access_level = (getModuleAccessLevel('Admin'));if ($_SESSION["int_user_type"]>1) {		$int_access_level = ACCESS_ADMIN;}function drawAccess($f_field, $f_qry) {	switch($f_qry->FieldByName($f_field)) {		case "0": echo "No Access"; break;		case "1": echo "Read Only"; break;		case "2": echo "Read/Write"; break;		case "3": echo "Admin"; break;	}}$grid = new Grid();//$grid->addColumn("ID", "sb.product_id", "number", true,100);$grid->addColumn("Module", "module_name", "string", true);$grid->addColumn("Storeroom", "description", "string", true);//$grid->addColumn("Access Level", "access_level", "number", true);$grid->addColumn("Access Level", "access_level", "custom", false, 100,"drawAccess"); function deleteRecord($f_record_id) {	$delQuery = new Query("select * from user_permissions where permission_id=$f_record_id");	if ($delQuery->RowCount()==0) 		return "Cannot find record.";	$delQuery->ExecuteQuery("DELETE from user_permissions where permission_id=$f_record_id");	$delQuery->Free();		return "Module deleted.";}//$grid->setDeletedField('deleted');$grid->setQuery("	SELECT *	FROM user_permissions up	INNER JOIN module m ON m.module_id=up.module_id	INNER JOIN stock_storeroom s ON s.storeroom_id=up.storeroom_id");$grid->setOnClick('gridClick','permission_id');$grid->setSubmitURL('userdetails.php');//$grid->addCustomParameter('id');$int_user_id = 0;if (!empty($_GET['id'])) {	$grid->addUniqueFilter('user_id', 'equals',$_GET['id'],'number');	$int_user_id = $_GET['id'];} else {	$grid->processParameters($_GET);}if (!empty($_GET["action"])) 	if ($_GET["action"]=="del") {		$_SESSION['str_admin_message'] = deleteRecord($_GET["delid"]);				header("Location:userdetails.php?id=$int_user_id&".$grid->buildQueryString());		exit;	}?><html><head><TITLE></TITLE><link href="../include/styles.css" rel="stylesheet" type="text/css"><script language='javascript'>var intSerialNumber=0;function getSelectedSerialNumber() {	return intSerialNumber;}function gridClick(id) {  intSerialNumber = id;}function newRecord() {	myWin = window.open("user_permission_edit.php?user_id=<? echo $_GET['id']; ?>",'user','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no,width=450,height=550,top=0');	myWin.moveTo((screen.availWidth/2 - 450/2), (screen.availHeight/2 - 550/2));	myWin.focus();}function openRecord() {	myWin = window.open("user_permission_edit.php?permission_id="+intSerialNumber,'user','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no,width=450,height=550,top=0');	myWin.moveTo((screen.availWidth/2 - 450/2), (screen.availHeight/2 - 550/2));	myWin.focus();}function modifyRecord() {	sNo = getSelectedSerialNumber();	if (sNo>0) {		openRecord(sNo);	}		else alert("Select a record to modify!");}function deleteRecord() {	sNo = getSelectedSerialNumber();	if (sNo>0) {		if (confirm("Are you sure you want to delete this module ?")) {			if (document.location.href.indexOf("?")<0) {				document.location = document.location.href+"?action=del&delid="+sNo;			} else {				document.location = document.location.href+"&action=del&delid="+sNo;			}		}	}	else		alert("Select a record to delete!");}function doResize() {	parent.parent.frames["admincontent"].doResize(2);}</script></head><body leftmargin=0 topmargin=0 marginwidth=0 marginheight=0><?$grid_form = new GridForm();//$grid->b_debug=true;$grid_form->setGrid($grid);if ($int_access_level == ACCESS_ADMIN) {	$grid_form->addButton('New Permission','../images/new.gif','newRecord','left');	$grid_form->addButton('Edit Permission','../images/modify.gif','modifyRecord','left');	$grid_form->addButton('Delete Permission','../images/delete.gif','deleteRecord()','left');}$grid_form->addControl('filter1','center');$grid_form->addControl('nav','right');$grid_form->addControl('refresh','right');$grid_form->addButton('Resize','../images/resize.gif','doResize','right');$grid_form->setFrames('detailsmenu','detailscontent');$grid_form->draw();if (IsSet($_SESSION['str_admin_message'])) {	if ($_SESSION['str_admin_message'] <> '') {		?><script language="JavaScript">			alert("<?echo $_SESSION['str_admin_message'];?>");		</script>		<?		$_SESSION["str_admin_message"]="";	}}?></body></html>